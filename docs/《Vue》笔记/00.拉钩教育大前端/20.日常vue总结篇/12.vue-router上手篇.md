> [å¯èƒ½æ¯”æ–‡æ¡£è¿˜è¯¦ç»†--VueRouterå®Œå…¨æŒ‡åŒ—](https://juejin.cn/post/6844903665388486664)
>
> [æ‰‹å†™Vue-routeræ ¸å¿ƒåŸç†ï¼Œå†ä¹Ÿä¸æ€•é¢è¯•å®˜é—®æˆ‘Vue-routeråŸç†](https://juejin.cn/post/6854573222231605256)
>
> [Vue-Routeré¢è¯•é¢˜æ±‡æ€»](https://juejin.cn/post/6844903961745440775)
>
> [vue3ä¸­vue-routerè¯¦è§£ï¼šåŸºæœ¬ä½¿ç”¨ï¼Œè·¯ç”±è·³è½¬ï¼ŒåµŒå¥—è·¯ç”±ï¼ŒåŠ¨æ€è·¯ç”±ï¼Œè·¯ç”±å®ˆå«](https://juejin.cn/post/7143890189524402183)

## ä»€ä¹ˆæ˜¯Vue-Routerï¼Ÿ

Vueè·¯ç”±å™¨æ˜¯Vue.jsçš„å®˜æ–¹è·¯ç”±å™¨ï¼Œå®ƒä¸Vue.jsæ ¸å¿ƒæ·±åº¦é›†æˆï¼Œä½¿ç”¨Vueè½»æ¾æ„å»ºå•é¡µåº”ç”¨ç¨‹åºå˜å¾—è½»è€Œæ˜“ä¸¾ã€‚åŠŸèƒ½åŒ…æ‹¬ï¼š

- åµŒå¥—è·¯çº¿æ˜ å°„
- åŠ¨æ€è·¯ç”±
- æ¨¡å—åŒ–ï¼ŒåŸºäºç»„ä»¶çš„è·¯ç”±å™¨é…ç½®
- è·¯ç”±å‚æ•°ï¼ŒæŸ¥è¯¢ï¼Œé€šé…ç¬¦
- æŸ¥çœ‹ç”±Vue.jsè¿‡æ¸¡ç³»ç»Ÿæä¾›åŠ¨åŠ›çš„è¿‡æ¸¡æ•ˆæœ
- ç»†ç²’åº¦çš„å¯¼èˆªæ§åˆ¶
- å¸¦æœ‰è‡ªåŠ¨æ´»åŠ¨CSSç±»çš„é“¾æ¥
- HTML5å†å²è®°å½•æ¨¡å¼æˆ–å“ˆå¸Œæ¨¡å¼
- å¯è‡ªå®šä¹‰çš„æ»šåŠ¨è¡Œä¸º
- ç½‘å€çš„æ­£ç¡®ç¼–ç 

## è·¯ç”±å®‰è£…

```css
npm i vue-router@4
```

## è·¯ç”±æ¨¡å¼

- `createWebHistory` åˆ›å»ºhistoryè·¯ç”±æ¨¡å¼
- `createWebHashHistory` åˆ›å»ºhashè·¯ç”±æ¨¡å¼
- `createMemoryHistory` åˆ›å»ºåŸºäºå†…å­˜çš„å†å²è®°å½•

è¿™ä¸‰ç§è·¯ç”±æ–¹å¼éƒ½æœ‰ä¸€ä¸ªå¯é€‰å‚æ•°baseï¼Œä¸ºæ¯ä¸ªURLå‰é¢çš„åŸºæœ¬è·¯å¾„ï¼Œé»˜è®¤ä¸º'/'

## é…ç½®è·¯ç”±

```javascript
// router/index

import { createRouter, createWebHistory,  RouteRecordRaw } from 'vue-router'
const Login = ()=> import('../views/login/login.vue')
const Home = ()=> import('../views/home/home.vue')
const About = ()=> import('../views/about/about.vue')
const routes: Array<RouteRecordRaw> = [  
    {    path: '/',    name: 'login',    component: Login  },  
    {    path: '/home',    name: 'home',    component: Home,  }, 
    {    path: '/about',    name: 'about',    component: About  },
]
const router = createRouter({  
    history: createWebHistory(),  
    routes
})

export default router


// main

import { createApp } from 'vue'
import App from './App.vue'
import router from './router/index'

const app = createApp(App).use(router).mount('#app')
```

æ–°ç‰ˆè·¯ç”±å™¨ä½¿ç”¨`createRouter`åˆ›å»ºï¼Œ`RouteRecordRaw`æ˜¯å†…ç½®çš„ç±»å‹æ¥å£ï¼Œ`routes`æ”¹ä¸ºå¿…ä¼ å‚æ•°ã€‚

## è·¯ç”±æ’æ§½

- `append`
- `event`
- `tag`
- `exact`

ä¸Šé¢åˆ—ä¸¾çš„4ä¸ªå±æ€§å·²ç»ä¸å†ä½¿ç”¨ï¼Œå¯åœ¨`app.config.globalProperties`é‡Œè‡ªå·±å®ç°å…¨å±€æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š

```javascript
// main.js
const app = createApp(App)
app.config.globalProperties.append = (path, pathToAppend) =>
  path + (path.endsWith('/') ? '' : '/') + pathToAppend

// home.vue
<router-link :to="append($route.path, 'child-route')"></router-link>
```

`router-link`æ”¹ä¸ºä½¿ç”¨ä½œç”¨åŸŸæ’æ§½:

```vue
<router-link to="/" v-slot="{ href, navigate, isActive }">
  <li :class="{ 'active': isActive }">
    <a :href="href" @click="navigate">
      <span>Home</span>
    </a>
  </li>
</router-link>
```

`<router-view> <keep-alive> <transition>`ç°åœ¨å¿…é¡»é€šè¿‡v-slot APIåœ¨`router-view`å†…éƒ¨ä½¿ç”¨`transition`å’Œ`keep-alive`ã€‚

```vue
<router-view v-slot="{ Component }">
  <transition>
    <keep-alive>
      <component :is="Component" />
    </keep-alive>
  </transition>
</router-view>
```

ç°æœ‰çš„`router.onReady`å‡½æ•°å·²æ›¿æ¢ä¸º`router.isReady`ï¼Œè¯¥å‡½æ•°ä¸æ¥å—ä»»ä½•å‚æ•°å¹¶è¿”å›`Promise`ï¼Œå› ä¸ºç°åœ¨å¯¼èˆªåŒ…å«ç¬¬ä¸€ä¸ªéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨`transition`ï¼Œéœ€è¦åœ¨æŒ‚è½½`dom`ä¹‹å‰è°ƒç”¨`isReady`ï¼š

```js
router.isReady().then(()=> app.mount('#app'))
```

## Vueè·¯ç”±å’ŒComposition API

å½“æˆ‘ä»¬ä½¿ç”¨`router-link`æ ‡ç­¾æ—¶æ˜¯ä¸€ç‚¹æ¯›ç—…ä¹Ÿæ²¡æœ‰ï¼Œä½†æ˜¯å½“éœ€è¦ç¼–ç¨‹å¼è·¯ç”±è·³è½¬çš„æ—¶å€™æ²™é›•äº†ï¼Œæ²¡æœ‰`this`å’‹è°ƒç”¨`router`å•Šï¼éš¾é“è¿˜è¦å†å†™ä¸€ä¸ª`methods`åœ¨é‡Œé¢æ“ä½œå—ï¼ˆé»‘äººé—®å·ï¼‰ï¼Œè¿˜å¥½è¿™é‡Œå’±ä»¬çš„`router`ç»™äº†è§£å†³åŠæ³•ï¼Œçœ‹ä¸‹å›¾ï¼š

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b53ef7608077415fb8f387ce5d49bbf2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp)

é‡Œåªéœ€è¦è°ƒç”¨å¯¹åº”çš„`userRouter`å‡½æ•°å°±å¯ä»¥äº†ï¼Œæ³¨æ„è¦åœ¨ä¸Šæ–¹`import`å¼•å…¥ï¼Œåœ¨`setup`é‡Œé¢ä¸ç”¨`return`è¿”å›ã€‚ï¼ˆè¿™é‡Œæ²¡æœ‰è´´ä»£ç ï¼Œè‡ªå·±æ‰‹åŠ¨æ•²ä¸€ä¸‹æ„Ÿå—ç¼–ç¨‹çš„å¿«ä¹ğŸ¤£ï¼‰

## RouterView

åœ¨ä¸€ç§æƒ…æ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦åœ¨é¡µé¢ä¸­åŒæ—¶æ˜¾ç¤ºå¤šä¸ªè·¯ç”±è§†å›¾ï¼Œè€Œä¸æ˜¯åµŒå¥—ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨åˆ°`router-view`çš„`name`å±æ€§ï¼Œé»˜è®¤ä½¿ç”¨`default`ï¼š

```javascript
// é¡µé¢

<router-view></router-view>
<router-view name="about"></router-view>
<router-view name="login"></router-view>


// router/index

const router = createRouter({
  history: createWebHashHistory(),
  routes: [
    {
      path: '/',
      components: {
        default: Home,
        // è¿™é‡Œæ˜¯es6å¯¹è±¡å¢å¼ºå†™æ³•
        login,
        // åŒç†
        about,
      },
    },
  ],
})
```

`components`é‡Œé¢çš„ç»„ä»¶ä¼šä¸`router-view`é‡Œé¢çš„`name`ç›¸å¯¹åº”ã€‚

## scrollBehaviorå˜åŒ–

`scrollBehavior`è¿”å›çš„å¯¹è±¡`x`é‡å‘½åä¸º`left`ï¼Œ`y`é‡å‘½åä¸º`top`ã€‚

## è·¯ç”±é‡å®šå‘ä¸åˆ«å

è·¯ç”±é‡å®šå‘(redirect)å°±æ˜¯é€šè¿‡å„ç§æ–¹æ³•å°†å„ç§ç½‘ç»œè¯·æ±‚é‡æ–°å®šä¸ªæ–¹å‘è½¬åˆ°å…¶å®ƒä½ç½®ï¼Œå¦‚`/home`è½¬åˆ°`/`

```js
// è·¯å¾„å†™æ³•
const routes = [{ path: '/home', redirect: '/' }]
// å‘½åå†™æ³•
const routes = [{ path: '/home', redirect: { name: 'homepage' } }]
// å‡½æ•°å†™æ³•
const routes = [
  {
    path: '/search/:searchText',
    redirect: to => {
      return { path: '/search', query: { q: to.params.searchText } }
    },
  },
]
```

åˆ«åè¡¨ç¤ºè®¿é—®`url`æ—¶è‡ªç”±å‘½åï¼Œä¸å—çº¦æŸï¼Œ`router`ä¼šè‡ªåŠ¨è¿›è¡Œåˆ«ååŒ¹é…ï¼Œå°±åƒæˆ‘ä»¬è®¾ç½®`/`çš„åˆ«åä¸º`/home`ï¼Œç›¸å½“äºè®¿é—®`/`ï¼š

```js
const routes = [{ path: '/', component: Homepage, alias: '/home' }]


// aliasæ˜¯åˆ«åçš„key
```

## åŠ¨æ€è·¯ç”±

åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯é‡Œé¢æˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨åˆ°åŠ¨æ€è·¯ç”±ï¼Œæ‰€ä»¥è¿™é‡Œç»™å‡ºäº†ä½¿ç”¨æ–¹å¼ï¼ŒåŠ¨æ€è·¯ç”±ä¸»è¦é€šè¿‡ä¸¤ä¸ªåŠŸèƒ½å®ç°`router.addRoute()`å’Œ`router.removeRoute()`ã€‚

```js
// addRouteæ˜¯æ·»åŠ ä¸€æ¡æ–°çš„è·¯ç”±è·¯å¾„

router.addRoute({ name: 'about', path: '/about', component: About })

// removeRouteæ˜¯åˆ é™¤è·¯ç”±ï¼Œæ³¨æ„åˆ é™¤åå¯¹åº”çš„å­è·¯ç”±å’Œåˆ«åéƒ½ä¼šåˆ æ‰

router.removeRoute('about')

// è·¯ç”±åµŒå¥—

router.addRoute('about', { path: 'profile', component: Profile})

//ç­‰ä»·äº

router.addRoute({
  name: 'about',
  path: '/about',
  component: About,
  children: [{ path: 'profile', component: Profile}],
})
```

Vue Router æä¾›äº†ä¸¤ä¸ªåŠŸèƒ½æ¥æŸ¥çœ‹ç°æœ‰çš„è·¯ç”±ï¼š

- `router.hasRoute`ï¼šæ£€æŸ¥è·¯ç”±æ˜¯å¦å­˜åœ¨ã€‚
- `router.getRoutes`ï¼šè·å–ä¸€ä¸ªåŒ…å«æ‰€æœ‰è·¯ç”±è®°å½•çš„æ•°ç»„ã€‚

## useRoute()å’ŒuseRouter()åŒºåˆ«

**useRoute()**

routeæ˜¯ä¸€ä¸ªè·³è½¬çš„è·¯ç”±å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªè·¯ç”±éƒ½ä¼šæœ‰ä¸€ä¸ªrouteå¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªå±€éƒ¨çš„å¯¹è±¡ï¼Œå¯ä»¥è·å–å¯¹åº”çš„name,path,params,queryç­‰ï¼š

matched: æ•°ç»„ï¼ŒåŒ…å«å½“å‰åŒ¹é…çš„è·¯å¾„ä¸­æ‰€åŒ…å«çš„æ‰€æœ‰ç‰‡æ®µæ‰€å¯¹åº”çš„é…ç½®å‚æ•°å¯¹è±¡

name: å½“å‰è·¯å¾„çš„åå­—ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨å…·åè·¯å¾„ï¼Œåˆ™åå­—ä¸ºç©ºã€‚

params: å¯¹è±¡ï¼ŒåŒ…å«è·¯ç”±ä¸­çš„åŠ¨æ€ç‰‡æ®µå’Œå…¨åŒ¹é…ç‰‡æ®µçš„é”®å€¼å¯¹

path: å­—ç¬¦ä¸²ï¼Œç­‰äºå½“å‰è·¯ç”±å¯¹è±¡çš„è·¯å¾„ï¼Œä¼šè¢«è§£æä¸ºç»å¯¹è·¯å¾„ï¼Œå¦‚ â€œ/home/newsâ€

query: å¯¹è±¡ï¼ŒåŒ…å«è·¯ç”±ä¸­æŸ¥è¯¢å‚æ•°çš„é”®å€¼å¯¹ã€‚ ä¾‹å¦‚ï¼Œå¯¹äº /home/news/detail/01?favorite=yes ï¼Œä¼šå¾—åˆ°$route.query.favorite => â€˜yesâ€™

**useRouter():**

routeræ˜¯VueRouterçš„ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡Vue.use(VueRouter)å’ŒVueRouteræ„é€ å‡½æ•°å¾—åˆ°ä¸€ä¸ªrouterçš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­æ˜¯ä¸€ä¸ªå…¨å±€çš„å¯¹è±¡ï¼Œä»–åŒ…å«äº†æ‰€æœ‰çš„è·¯ç”±åŒ…å«äº†è®¸å¤šå…³é”®çš„å¯¹è±¡å’Œå±æ€§ã€‚

ä¸¾ä¾‹ï¼šhistoryå¯¹è±¡

$router.push({path:â€˜homeâ€™});æœ¬è´¨æ˜¯å‘historyæ ˆä¸­æ·»åŠ ä¸€ä¸ªè·¯ç”±ï¼Œåœ¨æˆ‘ä»¬çœ‹æ¥æ˜¯ åˆ‡æ¢è·¯ç”±ï¼Œä½†æœ¬è´¨æ˜¯åœ¨æ·»åŠ ä¸€ä¸ªhistoryè®°å½•

æ–¹æ³•ï¼š $router.replace({path:â€˜homeâ€™});//æ›¿æ¢è·¯ç”±ï¼Œæ²¡æœ‰å†å²è®°å½•

```javascript
// è·å–è·¯ç”±å™¨å®ä¾‹
const router = useRouter()

// routeå“åº”å¼å¯¹è±¡
const route = useRoute()
watch(() => route.query, (query) => {
    console.log(query)
})

// å®ˆå« é¡µé¢ç¦»å¼€
onBeforeRouteLeave((to, from) => {
    const answer = window.confirm('ç¡®å®šç¦»å¼€å—')
    if (!answer) {
        return false
    }
})


function back() {
    console.log(router)
    router.push('/')
}
```

